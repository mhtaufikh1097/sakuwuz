{% extends "base.html" %}
{% load humanize %}
{% load formatting %} {# rupiah #}
{% block title %}Dashboard · Sakuwuz{% endblock %}
{% block content %}
<h4 class="mb-3">Dashboard — {{ month }}/{{ year }}</h4>

{% if budget %}
  <div class="row g-3">
    <div class="col-md-4">
      <div class="card card-stat shadow-sm">
        <div class="card-body">
          <div class="label">Budget Bulanan</div>
          <div class="value">{{ budget.nominal_max|rupiah }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card card-stat shadow-sm">
        <div class="card-body">
          <div class="label">Terpakai</div>
          <div class="value">{{ total_terpakai|rupiah }}</div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card card-stat shadow-sm {% if over %}border-danger{% endif %}">
        <div class="card-body">
          <div class="label">Sisa</div>
          <div class="value {% if over %}text-danger{% endif %}">
            {{ sisa|rupiah }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="mt-3">
    <div class="d-flex justify-content-between">
      <small class="text-muted">Utilisasi Budget</small>
      <small class="text-muted">{{ percent }}%</small>
    </div>
   <div class="progress">
  <div class="progress-bar
      {% if percent >= 100 %}bg-danger
      {% elif percent >= 80 %}bg-warning
      {% else %}bg-success
      {% endif %}"
      style="width: {{ percent }}%"></div>
</div>


  <div class="mt-4 d-flex gap-2">
    <a class="btn btn-primary" href="/expense/add/">Input Pengeluaran</a>
    <a class="btn btn-outline-secondary" href="/budget/set/">Ubah Budget</a>
  </div>

  <hr class="my-4">

  <h5 class="mb-3">Pengeluaran Hari Ini</h5>
  {% if expenses_today %}
    <div class="table-responsive">
      <table class="table table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:140px">Tanggal</th>
            <th>Deskripsi</th>
            <th class="text-end" style="width:180px">Nominal</th>
          </tr>
        </thead>
        <tbody>
          {% for e in expenses_today %}
          <tr>
            <td>{{ e.tanggal|date:"d M Y" }}</td>
            <td>{{ e.deskripsi }}</td>
            <td class="text-end">{{ e.nominal|rupiah }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <tbody>
  {% for row in pengeluaran_hari_ini %}
  <tr>
    <td>
      <a href="{% url 'expense_by_day' row.date.year row.date.month row.date.day %}">
        {{ row.date|date:"d M Y" }}
      </a>
    </td>
    <td>{{ row.description }}</td>
    <td class="text-end">Rp {{ row.amount|intcomma }}</td>
  </tr>
  {% endfor %}
</tbody>
  {% endif %}
{% else %}
  <div class="alert alert-warning shadow-sm">Belum ada budget bulan ini. Silakan set dulu.</div>
  <a class="btn btn-primary" href="/budget/set/">Set Budget</a>
{% endif %}
{% endblock %}
